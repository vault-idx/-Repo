<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behind the Darkness</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#000;color:#0f0;font-family:'Courier New',monospace;overflow:hidden;height:100vh;cursor:none}
        #startBtn{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);padding:35px 90px;font-size:3.2rem;border:6px solid #0f0;background:#000;color:#0f0;transition:.5s;z-index:100}
        #startBtn:hover{background:#0f0;color:#000;box-shadow:0 0 70px #0f0}
        #typewriter,#subtext,#trollNote{position:absolute;width:92%;left:50%;transform:translateX(-50%);text-align:center;opacity:0;font-size:2.5rem;line-height:1.4}
        #typewriter{top:10%}
        #subtext{top:32%;font-size:2rem;color:#0bb}
        #trollNote{top:75%;font-size:2.3rem;color:#f55}
        #buttons{position:absolute;top:55%;left:50%;transform:translateX(-50%);display:flex;gap:140px;opacity:0;z-index:10}
        .btn{padding:35px 100px;font-size:3.2rem;border:6px solid;cursor:pointer;transition:all .4s;position:relative}
        .no{background:#001a00;border-color:#0f0;color:#0f0}
        .yes{background:#1a0000;border-color:#f00;color:#f00}
        .yes.glow{box-shadow:0 0 140px #f00;transform:scale(1.35);z-index:11}
        #emergencyLights{position:fixed;inset:0;pointer-events:none;opacity:0;z-index:20;
            background:
                radial-gradient(circle at 5% 5%, #f006 15%, transparent 16%),
                radial-gradient(circle at 95% 5%, #f006 15%, transparent 16%),
                radial-gradient(circle at 5% 95%, #f006 15%, transparent 16%),
                radial-gradient(circle at 95% 95%, #f006 15%, transparent 16%);
            animation:spin 2.8s linear infinite;
        }
        @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        #scratchCanvas{position:fixed;inset:0;opacity:0;pointer-events:none;z-index:30}
        #secret{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;z-index:25}
        #qrCode{max-width:320px;margin:50px 0;border:15px solid #0ff;box-shadow:0 0 80px #0ff;border-radius:10px}
        .final-note{font-size:2rem;margin:50px 0;animation:fadeGlow 7s infinite}
        .password-box{font-size:2.8rem;margin-top:30px}
        #copyBtn{margin-left:35px;padding:18px 45px;background:#0f0;color:#000;border:none;cursor:pointer;font-weight:bold;border-radius:8px}
        @keyframes fadeGlow{0%,100%{opacity:0.6;text-shadow:0 0 20px #0ff}50%{opacity:1;text-shadow:0 0 100px #0ff}}
        @keyframes vibrate{0%,100%{transform:translate(0)}20%,60%{transform:translate(-35px,30px)}40%,80%{transform:translate(35px,-30px)}}
    </style>
</head>
<body>
    <div id="startBtn">CLICK TO BEGIN</div>

    <div id="typewriter"></div>
    <div id="subtext"></div>
    <div id="trollNote"></div>

    <div id="buttons">
        <button id="noBtn" class="btn no">NO</button>
        <button id="yesBtn" class="btn yes">YES</button>
    </div>

    <div id="emergencyLights"></div>
    <canvas id="scratchCanvas"></canvas>

    <div id="secret">
        <img src="qrcode.png" id="qrCode" style="display:none;">
        <p class="final-note">
            Use a laptop or desktop for the best experience.<br>
            Mobile? → three dots → "Desktop site" → reload.
        </p>
        <div class="password-box">
            <span>20.11.2001</span>
            <button id="copyBtn">Copy</button>
        </div>
    </div>

    <audio id="bgMusic" loop preload="auto">
        <source src="backgroundmusic.mp3" type="audio/mpeg">
        <source src="backgroundmusic.m4a" type="audio/mp4">
    </audio>
    <audio id="typeSound" preload="auto" src="keyboard.mp3"></audio>
    <audio id="siren" preload="auto" src="siren.mp3"></audio>

    <script>
        const startBtn = document.getElementById('startBtn');
        const typewriter = document.getElementById('typewriter');
        const subtext = document.getElementById('subtext');
        const trollNote = document.getElementById('trollNote');
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const lights = document.getElementById('emergencyLights');
        const canvas = document.getElementById('scratchCanvas');
        const secret = document.getElementById('secret');
        const qrCode = document.getElementById('qrCode');
        const copyBtn = document.getElementById('copyBtn');

        const bgMusic = document.getElementById('bgMusic');
        const typeSound = document.getElementById('typeSound');
        const siren = document.getElementById('siren');

        let attempts = 0;
        let scratchReady = false;

        // Fallback for audio load
        bgMusic.addEventListener('error', () => console.log('Music load failed - continuing without sound'));
        typeSound.addEventListener('error', () => console.log('Type sound load failed - continuing'));
        siren.addEventListener('error', () => console.log('Siren load failed - continuing'));

        startBtn.onclick = () => {
            startBtn.remove();
            bgMusic.volume = 0.7;
            bgMusic.play().catch(e => console.log('Music play failed:', e));
            typeWriter("Why are you here? Do you want to know what lies behind the darkness?", typewriter, 110, () => {
                typeWriter("If yes then press red. If not then go for green.", subtext, 90, () => {
                    document.getElementById('buttons').style.opacity = 1;
                });
            });
        };

        noBtn.onmouseenter = noBtn.onclick = () => {
            attempts++;
            noBtn.style.position = 'fixed';
            noBtn.style.left = Math.random() * (innerWidth - 300) + 50 + 'px';
            noBtn.style.top = Math.random() * (innerHeight - 200) + 50 + 'px';
            noBtn.style.animation = 'vibrate 0.9s';
            yesBtn.classList.add('glow');
            setTimeout(() => yesBtn.classList.remove('glow'), 1300);

            if (attempts === 6) {
                typeWriter("Maybe the button doesn't want to let you touch it. Try the other one.", trollNote, 100);
            }
        };

        yesBtn.onclick = () => {
            document.getElementById('buttons').style.opacity = 0;
            typewriter.style.opacity = subtext.style.opacity = trollNote.style.opacity = 0;
            lights.style.opacity = 1;
            siren.volume = 0.9;
            siren.play().catch(e => console.log('Siren play failed:', e));

            setTimeout(() => {
                lights.style.opacity = 0;
                siren.pause();
                siren.currentTime = 0;
                showScratchCover();
            }, 6000);
        };

        function showScratchCover() {
            const img = new Image();
            img.src = 'scratchcover.jpeg';
            img.onload = () => {
                canvas.width = innerWidth;
                canvas.height = innerHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                canvas.style.opacity = 1;
                canvas.style.pointerEvents = 'auto';
                secret.style.opacity = 1;
                qrCode.style.display = 'block';
                ctx.globalCompositeOperation = 'destination-out';
                scratchReady = true;
            };
            img.onerror = () => {
                // Fallback without image - direct to secret
                canvas.style.opacity = 1;
                secret.style.opacity = 1;
                qrCode.style.display = 'block';
                scratchReady = true;
                console.log('Scratch image failed - showing secret directly');
            };
        }

        canvas.onmousemove = canvas.ontouchmove = (e) => {
            if (!scratchReady) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.arc(x, y, 85, 0, Math.PI * 2);
            ctx.fill();
        };

        function typeWriter(text, el, speed, cb) {
            el.style.opacity = 1;
            el.innerHTML = '';
            let i = 0;
            typeSound.currentTime = 0;
            typeSound.play().catch(e => console.log('Type sound play failed:', e));
            const interval = setInterval(() => {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i);
                    i++;
                } else {
                    clearInterval(interval);
                    typeSound.pause();
                    if (cb) cb();
                }
            }, speed);
        }

        copyBtn.onclick = () => {
            navigator.clipboard.writeText('20.11.2001').catch(e => alert('Copy failed: ' + e));
            copyBtn.textContent = 'Copied!';
            setTimeout(() => copyBtn.textContent = 'Copy', 2000);
        };

        window.addEventListener('resize', () => location.reload());
    </script>
</body>
</html>
